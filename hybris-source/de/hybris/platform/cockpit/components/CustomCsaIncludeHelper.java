package de.hybris.platform.cockpit.components;

import org.zkoss.util.resource.Labels;
import org.zkoss.zk.ui.Component;
import org.zkoss.zul.Div;
import org.zkoss.zul.Html;

public class CustomCsaIncludeHelper extends Div
{
    private String getRootLoadingMessage()
    {
        String ret = Labels.getLabel("general.rootLoadingMessage");
        return (ret == null) ? "Loading" : ret;
    }


    public CustomCsaIncludeHelper()
    {
        String html = "<script type=\"text/javascript\">var rootLoadingMessage = \"" + getRootLoadingMessage()
                        + "\";\t\t\t\t\t\t\n\t\t\t\tvar initLoad = 10;\t\n\t\t\t\t\n\t\t\t\tzk._updCnt = function () {\n\t\t\t\t\tvar n = $e(\"zk_loadcnt\");\n\t\t\t\t\t//if (n) n.innerHTML = \"\" + zk.loading;\n\t\t\t\t\t//alert(zk.loading);\n\t\t\t\t\tif (n) { try { n.style.width=(((initLoad - zk.loading) * 200) / initLoad)+\"px\"; } catch (e) {}}\n\t\t\t\t\t//zk.loading=initLoad;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tzk._bld = function () {\n\t\t\t\t\tif (zk.loading ++) {\n\t\t\t\t\t\tzk._updCnt();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tzk.disableESC();\n\t\n\t\t\t\t\t\tzk._ckload = setInterval(function () {\n\t\t\t\t\t\t\t//alert(zk.loading);\n\t\t\t\t\t\t\tfor (var j = 0, cl = zk._ckfns.length; j < cl; ++j)\n\t\t\t\t\t\t\t\tif (zk._ckfns[j]()) {\n\t\t\t\t\t\t\t\t\tzk._ckfns.splice(j--, 1);\n\t\t\t\t\t\t\t\t\t--cl;\n\t\t\t\t\t\t\t\t\tzk.ald();\n\t\t\t\t\t\t\t\t} else return; //wait a while\n\t\t\t\t\t\t}, 10);\n\t\n\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\tif (zk.loading || window.dbg_progressbox) {\n\t\t\t\t\t\t\t\tvar n = $e(\"zk_loadprog\");\n\t\t\t\t\t\t\t\tif (!n)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar msg = \"<span>\"+rootLoadingMessage+\"</span><div style='width: 200px; height: 20px; border: 1px solid #CCC'>\"\n\t\t\t\t\t\t\t\t\t+\"<div id='zk_loadcnt' style='width: 0px; height: 20px; background-image:url(cockpit/css/images/button_back.gif);'/></div>\";\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tBoot_progressbox(\"zk_loadprog\", msg, 0, 0, true, true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 350);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\n\t\t\t\twindow.Boot_progressbox = function (id, msg, x, y, mask, center) {\n\t\t\t\t\t//zk.loading=50;\n\t\t\t\t\tinitLoad = zk.loading;\n\t\t\t\t\tvar html = '<div id=\"'+id+'\"';\n\t\t\t\t\tvar ix = zk.innerX(), iy = zk.innerY();\n\t\t\t\t\tif (mask) {\n\t\t\t\t\t\tif (zk._ctpgs.length) {\n\t\t\t\t\t\t\tfor (var c = zk._ctpgs.length, e = $e(zk._ctpgs[--c]); e; e = $e(zk._ctpgs[--c]))\n\t\t\t\t\t\t\t\tzk.applyMask(e);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\thtml += '><div id=\"zk_mask\" class=\"z-modal-mask\" style=\"display:block;left:'+ ix + 'px;top:' + iy +\t\n\t\t\t\t\t\t\t'px;\" z.x=\"' + ix + '\" z.y=\"' + iy + '\"></div><div';\n\t\t\t\t\t} else html += \"><div\";\n\t\t\n\t\t\t\t\tif (typeof x != 'string' || x.indexOf(\"%\") == -1) x += \"px\";\n\t\t\t\t\tif (typeof y != 'string' || y.indexOf(\"%\") == -1) y += \"px\";\n\t\t\n\t\t\t\t\tvar spinner = '<span class=\\\"z-loading-icon z-inline-block\\\"  alt=\\\"...\\\"></span> ';\n\t\t\t\t\t\n\t\t\t\t\tif(msg.substr(0,15) == \"Loading (<span id=\\\"zk_loadcnt\\\">\".substr(0,15) )\n\t\t\t\t\t{\n\t\t\t\t\t\tmsg = \"<span>\"+rootLoadingMessage+\"</span><div style='width: 200px; height: 20px; border: 1px solid #CCC'>\"\n\t\t\t\t\t\t+\"<div id='zk_loadcnt' style='width: 0px; height: 20px; background-image:url(cockpit/css/images/button_back.gif);'/></div>\";\n\t\t\t\t\t\t\n\t\t\t\t\t\tspinner = '';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\thtml += ' id=\"zk_loading\" class=\"z-loading\" style=\"left:'+x+';top:'+y+';visibility: hidden;\"'\n\t\t\t\t\t+' z.x=\"' + ix + '\" z.y=\"' + iy + '\"><div class=\"z-loading-indicator\" style=\"padding: 15px;\">'\n\t\t\t\t\t+ spinner+msg+'</div></div></div>';\n\t\t\t\t\t\n\t\t\t\t\tvar n = document.createElement(\"DIV\");\n\t\t\t\t\tdocument.body.appendChild(n);\n\t\t\t\t\tzk._setOuterHTML(n, html);\n\t\t\t\t\tif (mask) {\n\t\t\t\t\t\tvar mk = $e(\"zk_mask\");\n\t\t\t\t\t\tzk.listen(mk, \"mousemove\", Event.stop);\n\t\t\t\t\t\tzk.listen(mk, \"click\", Event.stop);\n\t\t\t\t\t}\n\t\t\t\t\tvar el = $e(\"zk_loading\");\n\t\t\t\t\tif (center) {\n\t\t\t\t\t\tif (el) {\n\t\t\t\t\t\t\tel.style.left = (zk.innerWidth() - el.offsetWidth) / 2 + ix + \"px\";\n\t\t\t\t\t\t\tel.style.top = (zk.innerHeight() - el.offsetHeight) / 2 + iy + \"px\";\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// the use is for zkau._fixOffset\n\t\t\t\t\t\t\tsetZKAttr(el, \"x\", ix);\n\t\t\t\t\t\t\tsetZKAttr(el, \"y\", iy);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tzk.cleanVisibility(el);\n\t\t\t\t\t//alert(html);\n\t\t\t\t\treturn $e(id);\n\t\t\t\t}; \n\t</script>\t\t";
        appendChild((Component)new Html(html));
    }
}
